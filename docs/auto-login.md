# Автоматический логин в веб-приложении

## Обзор

Реализована система автоматического логина для веб-приложения, которая сохраняет данные аутентификации в localStorage и автоматически входит в систему при повторном посещении.

## Как это работает

### 1. Сохранение данных логина

При успешном входе через Telegram WebApp, система автоматически сохраняет следующие данные в localStorage:

- **email**: Сгенерированный email для Supabase Auth (`telegram_{telegram_id}@example.com`)
- **password**: Случайно сгенерированный пароль
- **telegramId**: ID пользователя в Telegram
- **userId**: UUID пользователя в Supabase Auth
- **timestamp**: Время сохранения (для контроля срока действия)

### 2. Автоматический логин

При загрузке приложения система:

1. Проверяет наличие активной сессии Supabase
2. Если сессии нет, пытается восстановить её из сохраненных данных
3. При успешном восстановлении автоматически входит пользователя в систему
4. Обновляет timestamp для продления срока действия данных

### 3. Управление данными

- **Срок действия**: Данные действительны 30 дней
- **Автоматическое удаление**: При выходе из системы данные удаляются
- **Очистка при ошибках**: При неудачном логине данные автоматически удаляются

## Файлы

### `lib/auth-storage.ts`
Утилиты для работы с localStorage:

```typescript
// Сохранение данных
saveAuthData({
  email: 'telegram_123@example.com',
  password: 'random_password',
  telegramId: 123,
  userId: 'uuid'
});

// Получение данных
const authData = getAuthData();

// Проверка наличия данных
const hasData = hasAuthData();

// Удаление данных
removeAuthData();
```

### `components/UserContext.tsx`
Обновленный контекст с поддержкой автоматического логина:

- `attemptAutoLogin()`: Функция автоматического логина
- `signOut()`: Выход из системы с очисткой данных
- `hasAuthData()`: Проверка наличия сохраненных данных

### `components/AuthStatusCard.tsx`
Компонент для отображения статуса аутентификации (только в development режиме).

## Безопасность

### Меры безопасности:

1. **Ограниченный срок действия**: Данные действительны только 30 дней
2. **Автоматическая очистка**: Данные удаляются при выходе или ошибках
3. **Локальное хранение**: Данные хранятся только в браузере пользователя
4. **Валидация**: Проверка корректности данных перед использованием

### Рекомендации:

- Данные паролей генерируются случайно и не связаны с реальными паролями пользователя
- Используйте HTTPS для защиты данных в transit
- Рассмотрите возможность добавления дополнительной проверки устройства

## Использование

### Для разработчиков:

```typescript
import { useUser } from '@/components/UserContext';

function MyComponent() {
  const { authUser, signOut, hasAuthData } = useUser();
  
  // Проверить статус аутентификации
  if (authUser) {
    console.log('Пользователь авторизован');
  }
  
  // Проверить наличие сохраненных данных
  if (hasAuthData()) {
    console.log('Есть сохраненные данные для автологина');
  }
  
  // Выйти из системы
  const handleSignOut = () => {
    signOut();
  };
}
```

### Для пользователей:

1. **Первый вход**: Откройте приложение через Telegram WebApp
2. **Автоматический вход**: При повторном посещении вы автоматически войдете в систему
3. **Выход**: Используйте кнопку "Выйти из системы" для полного выхода

## Отладка

### Логи в консоли:

- `"Auth data saved to localStorage"` - Данные сохранены
- `"Attempting auto-login with saved credentials"` - Попытка автологина
- `"Auto-login successful"` - Успешный автологин
- `"Auto-login failed"` - Неудачный автологин

### Проверка localStorage:

```javascript
// В консоли браузера
console.log(localStorage.getItem('v0_auth_data'));
```

## Будущие улучшения

1. **Шифрование данных**: Добавить шифрование чувствительных данных
2. **Биометрическая аутентификация**: Интеграция с WebAuthn
3. **Множественные устройства**: Синхронизация между устройствами
4. **Настройки пользователя**: Возможность отключить автологин
